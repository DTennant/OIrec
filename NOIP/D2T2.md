首先我们考虑 q=0 的情况——蚯蚓长度不增长，那么每次取出的蚯蚓长度一定单调不增。我们可以维护三个单调不增的序列，初始的时候第一个序列是原序列（从大到小排序），第二个序列是左半部分蚯蚓序列（一开始是空的），第三个序列是右半部分蚯蚓序列（一开始是空的）。每一次取出蚯蚓，找到三个序列首最大的蚯蚓，剁成左右两部分加入左半部分蚯蚓序列和右半部分蚯蚓序列的末尾。显然第二、三个序列也是单调不增的，所以整个操作可以在 O(nlogn+m) 的复杂度内完成。

接着考虑 q≠0 的情况——蚯蚓长度每次增长，注意到每次只有取出来的蚯蚓不增长，其余的蚯蚓都要 +q，那么其实上可以将每一个蚯蚓都 +q，然后将剁成的两个蚯蚓 -q。每一次取出的蚯蚓长度还是单调递减的！因为每次的操作是取出蚯蚓，剁成两部分，然后 −q 再放回去，整个过程中没有蚯蚓的长度相对增加（整体 +q 是不影响相对长度的），所以我们依然可以套用之前的算法，只不过每次切除的时候要换算一下蚯蚓的长度（因为每次 +q 并不真正直接加上，而是打了一个“标记”）。

复杂度：O(nlogn+m)。